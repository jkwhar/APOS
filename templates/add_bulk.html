{% extends "base.html" %}
{% block title %}Bulk Add Parts â€” APOS Inventory{% endblock %}

{% block content %}

<!-- adds toggle for single or bulk add -->

<h2 class="mb-4 fw-bold text-primary">ðŸ“¦ Bulk Add Parts (5 Rows)</h2>

<div class="mb-3">
    <a href="/add" class="btn btn-outline-secondary btn-sm">
        âž• Switch to Single Add
    </a>
</div>

<div class="card shadow-sm">
    <div class="card-body">

        <form action="/add/bulk" method="post" class="row g-3">

            <!-- Global Controls -->
            <div class="col-12">
                <label class="form-label fw-bold">Global Category</label>
                <div class="input-group mb-3">
                    <select id="global_category" class="form-select">
                        <option value="">-- None --</option>
                        {% for cat in categories %}
                        <option value="{{ cat.name }}">{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                    <button type="button" class="btn btn-outline-primary"
                            onclick="applyCategoryToAll()">Apply to All</button>
                </div>
            </div>

            <div class="col-12">
                <label class="form-label fw-bold">Global Store</label>
                <div class="input-group mb-3">
                    <select id="global_store" class="form-select">
                        <option value="">-- None --</option>
                        {% for s in stores %}
                        <option value="{{ s.name }}">{{ s.name }}</option>
                        {% endfor %}
                    </select>
                    <button type="button" class="btn btn-outline-primary"
                            onclick="applyStoreToAll()">Apply to All</button>
                </div>
            </div>

            <!-- Table -->
            <div class="col-12 table-responsive">
                <table class="table table-bordered table-striped align-middle text-center">
                    <thead class="table-light">
                        <tr>
                            <th>Part Number</th>
                            <th>Category</th>
                            <th>Store</th>
                            <th>Description</th>
                            <th>Price</th>
                            <th>Qty</th>
                            <th>Barcode</th>
                            <th>Bin Code</th>
                        </tr>
                    </thead>

                    <tbody>
                    {% for r in rows %}
                        <tr>
                            <td>
                                <input type="text" name="part_number"
                                       class="form-control"
                                       onblur="autoFillFromPartNumber(this)">
                            </td>

                            <td>
                                <select name="category" class="form-select row_category">
                                    <option value="">-- None --</option>
                                    {% for cat in categories %}
                                    <option value="{{ cat.name }}">{{ cat.name }}</option>
                                    {% endfor %}
                                </select>
                            </td>

                            <td>
                                <select name="store" class="form-select row_store">
                                    <option value="">-- None --</option>
                                    {% for s in stores %}
                                    <option value="{{ s.name }}">{{ s.name }}</option>
                                    {% endfor %}
                                </select>
                            </td>

                            <td>
                                <input type="text" name="description" class="form-control">
                            </td>

                            <td>
                                <input type="number" step="0.01" name="price" class="form-control">
                            </td>

                            <td>
                                <input type="number" name="quantity" value="0" class="form-control">
                            </td>

                            <td>
                                <input type="text" name="barcode" class="form-control">
                            </td>

                            <td>
                                <input type="text" name="bin_code" class="form-control">
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="col-12 text-end">
                <button type="submit" class="btn btn-primary btn-lg">Add All Parts</button>
            </div>

        </form>

    </div>
</div>

<script>
function applyCategoryToAll() {
    const value = document.getElementById('global_category').value;
    document.querySelectorAll('.row_category').forEach(x => x.value = value);
}
function applyStoreToAll() {
    const value = document.getElementById('global_store').value;
    document.querySelectorAll('.row_store').forEach(x => x.value = value);
}
</script>

<script src="/static/autofill.js"></script>

{% endblock %}