{% set cfg = display_config if display_config is defined else {} %}
{% set rows = parts if parts is defined else [] %}

<div class="table-responsive">
  <table class="table table-hover table-sm align-middle mb-0">
    <thead class="table-light">
      <tr>
        {% if cfg.get("id", True) %}<th scope="col">ID</th>{% endif %}
        {% if cfg.get("part_number", True) %}<th scope="col">Part #</th>{% endif %}
        {% if cfg.get("category", True) %}<th scope="col">Category</th>{% endif %}
        {% if cfg.get("store", True) %}<th scope="col">Store</th>{% endif %}
        {% if cfg.get("manufacturer", True) %}<th scope="col">Manufacturer</th>{% endif %}
        {% if cfg.get("description", True) %}<th scope="col">Description</th>{% endif %}
        {% if cfg.get("price", True) %}<th scope="col" class="text-end">Price</th>{% endif %}
        {% if cfg.get("quantity", True) %}<th scope="col" class="text-end">Qty</th>{% endif %}
        {% if cfg.get("barcode", True) %}<th scope="col">Barcode</th>{% endif %}
        {% if cfg.get("bin_code", True) %}<th scope="col">Bin</th>{% endif %}
        {% if cfg.get("usage", True) %}<th scope="col" class="text-end">Usage / History</th>{% endif %}
      </tr>
    </thead>
    <tbody>
    {% if rows %}
      {% for part in rows %}
      <tr>
        {% if cfg.get("id", True) %}
          <td class="text-muted small">{{ part.id }}</td>
        {% endif %}

        {% if cfg.get("part_number", True) %}
          <td class="fw-semibold">
            <a href="/part/{{ part.id }}/history" class="text-decoration-none">{{ part.part_number }}</a>
          </td>
        {% endif %}

        {% if cfg.get("category", True) %}
          <td>{{ part.category or "—" }}</td>
        {% endif %}

        {% if cfg.get("store", True) %}
          <td>{{ part.store or "—" }}</td>
        {% endif %}

        {% if cfg.get("manufacturer", True) %}
          <td>{{ part.manufacturer or "—" }}</td>
        {% endif %}

        {% if cfg.get("description", True) %}
          <td>{{ part.description or "—" }}</td>
        {% endif %}

        {% if cfg.get("price", True) %}
          <td class="text-end">{{ ("$%.2f" % part.price) if part.price is not none else "—" }}</td>
        {% endif %}

        {% if cfg.get("quantity", True) %}
          {% set qty = part.quantity or 0 %}
          {% set qty_class = "text-success" if qty > 2 else "text-warning" if qty > 0 else "text-danger" %}
          <td class="text-end fw-semibold {{ qty_class }}">{{ qty }}</td>
        {% endif %}

        {% if cfg.get("barcode", True) %}
          <td class="font-monospace">{{ part.barcode or "—" }}</td>
        {% endif %}

        {% if cfg.get("bin_code", True) %}
          <td>{{ part.bin_code or "—" }}</td>
        {% endif %}

        {% if cfg.get("usage", True) %}
          <td class="text-end text-nowrap">
            <a href="/part/{{ part.id }}/history" class="btn btn-link btn-sm">History</a>
            <a href="/part/{{ part.id }}/edit" class="btn btn-outline-secondary btn-sm">Edit</a>
            <form action="/find/use/{{ part.id }}" method="post" class="d-inline">
              <button type="submit"
                      class="btn btn-outline-success btn-sm"
                      {% if (part.quantity or 0) <= 0 %}disabled{% endif %}>
                Use 1
              </button>
            </form>
          </td>
        {% endif %}
      </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="12" class="text-center text-muted py-4">No matching parts.</td>
      </tr>
    {% endif %}
    </tbody>
  </table>
</div>
